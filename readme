
readme


1.  ë‹¹ì‹ ì€ ì¸í”„ë¼ ì „ë¬¸ê°€ ì…ë‹ˆë‹¤.
2. azure í´ë¼ìš°ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- 4 vCPU, 16G memory
3. springboot3.x, ë‚´ì¥ëœ tomcat serverë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
4. í˜„ì¬ í™˜ê²½ì— ë§ëŠ” ìµœì í™”ëœ JVM ì„¤ì •ì„ ì œê³µí•´ ì£¼ì„¸ìš”


1. ì „ì œ ì¡°ê±´ì— ëŒ€í•œ ì¸í”„ë¼ ê´€ì  íŒë‹¨
VM ìŠ¤í™ í•´ì„

vCPU: 4 Core

Memory: 16 GB

Spring Boot 3.x â†’ Java 17 ì´ìƒ

Embedded Tomcat â†’ Thread ê¸°ë°˜ ë™ì‹œì„±

Azure VM íŠ¹ì„±:

CPU burst ì—†ìŒ (ì¼ë°˜ VM ê¸°ì¤€)

ë©”ëª¨ë¦¬ OOM ë°œìƒ ì‹œ ì¦‰ì‹œ í”„ë¡œì„¸ìŠ¤ Kill ê°€ëŠ¥

ì»¨í…Œì´ë„ˆê°€ ì•„ë‹ˆë¼ VM ë‹¨ë… JVM ì‹¤í–‰ â†’ Heapì„ ë„‰ë„‰íˆ ì‚¬ìš© ê°€ëŠ¥

2. Heap ë©”ëª¨ë¦¬ ì„¤ê³„ (ê°€ì¥ ì¤‘ìš”)
ê¸°ë³¸ ì›ì¹™

ì „ì²´ RAMì˜ 50~60%ë§Œ Heap

ë‚˜ë¨¸ì§€ëŠ”:

Metaspace

Thread Stack

Direct Memory (NIO, Netty ë“±)

OS Page Cache

Azure Agent ì˜ì—­

ê¶Œì¥ Heap í¬ê¸°
ì´ ë©”ëª¨ë¦¬: 16GB
Heap: 8GB ~ 10GB


ìš´ì˜ ì•ˆì •ì„±ì„ ìµœìš°ì„ ìœ¼ë¡œ í•˜ë©´ 8GB ê¶Œì¥

3. Garbage Collector ì„ íƒ (Spring Boot 3.x ê¸°ì¤€)
ê¶Œì¥ GC: G1GC (ê¸°ë³¸ê°’ì´ì§€ë§Œ ëª…ì‹œ ê¶Œì¥)

ì´ìœ :

ëŒ€ìš©ëŸ‰ Heapì— ì•ˆì •ì 

Pause Time ì œì–´ ê°€ëŠ¥

ì›¹ ì„œë²„ ì›Œí¬ë¡œë“œì— ì í•©

CMSëŠ” Java 17ì—ì„œ ì œê±°ë¨

ZGC/ShenandoahëŠ” íŠœë‹ ë‚œì´ë„ â†‘ (4 vCPUì—ì„œëŠ” ì´ì  ì ìŒ)

4. ìµœì í™”ëœ JVM ì˜µì…˜ (ìš´ì˜ìš©)
ìµœì¢… ê¶Œì¥ JVM ì˜µì…˜ (Strongly Recommended)
-Xms8g
-Xmx8g

-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
-XX:InitiatingHeapOccupancyPercent=45

-XX:+ParallelRefProcEnabled
-XX:+UseStringDeduplication

-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/var/log/jvm/heapdump.hprof

-XX:+ExitOnOutOfMemoryError

-XX:MetaspaceSize=256m
-XX:MaxMetaspaceSize=512m

-Xss512k

-Dfile.encoding=UTF-8
-Djava.security.egd=file:/dev/urandom

5. ì˜µì…˜ë³„ í•µì‹¬ ì„¤ëª… (ì™œ í•„ìš”í•œê°€)
Heap ê´€ë ¨
ì˜µì…˜	ì„¤ëª…
-Xms8g -Xmx8g	Heap ê³ ì • â†’ Full GC ì‹œ ë¦¬ì‚¬ì´ì¦ˆ ë¹„ìš© ì œê±°
InitiatingHeapOccupancyPercent=45	Heap 45% ì°¨ë©´ GC ì‹œì‘ â†’ Old ì˜ì—­ ì••ë°• ë°©ì§€
GC ì„±ëŠ¥
ì˜µì…˜	íš¨ê³¼
MaxGCPauseMillis=200	ì›¹ ìš”ì²­ latency ì•ˆì •í™”
ParallelRefProcEnabled	Reference ì²˜ë¦¬ ë³‘ë ¬í™”
UseStringDeduplication	Spring/JSON ë¬¸ìì—´ ë©”ëª¨ë¦¬ ì ˆê°
OOM ëŒ€ì‘
ì˜µì…˜	ì´ìœ 
HeapDumpOnOutOfMemoryError	ì¥ì•  ì›ì¸ ë¶„ì„ í•„ìˆ˜
ExitOnOutOfMemoryError	ë¹„ì •ìƒ ìƒíƒœì—ì„œ ì‚´ì•„ë‚¨ëŠ” ê²ƒ ë°©ì§€

Azureì—ì„œëŠ” ë¹„ì •ìƒ JVMì´ ì‚´ì•„ìˆìœ¼ë©´ ë” ìœ„í—˜í•©ë‹ˆë‹¤.

Thread Stack
ì˜µì…˜	ì„¤ëª…
-Xss512k	Tomcat thread ìˆ˜ê°€ ë§ì•„ë„ Stack ë©”ëª¨ë¦¬ ì ˆê°

Tomcat ê¸°ë³¸ ìµœëŒ€ thread(200 ê¸°ì¤€)ì—ì„œë„ ì•ˆì „

Metaspace
ì˜µì…˜	ì´ìœ 
MaxMetaspaceSize=512m	ClassLoader ëˆ„ìˆ˜ ë°©ì–´
MetaspaceSize=256m	ì¦ì€ Full GC ë°©ì§€
6. Spring Boot + Tomcat ì¶”ê°€ ê¶Œì¥ ì„¤ì • (ì¤‘ìš”)
application.yml (ì„œë²„ íŠœë‹)
server:
  tomcat:
    threads:
      max: 200
      min-spare: 20
    accept-count: 100
    max-connections: 8192


4 vCPU ê¸°ì¤€:

max threads 200 ì´ìƒì€ ì˜ë¯¸ ì—†ìŒ

CPU saturation ë°©ì§€ ëª©ì 

7. GC ë¡œê·¸ (ìš´ì˜ í™˜ê²½ í•„ìˆ˜)
GC ë¡œê·¸ ì˜µì…˜ (Java 17)
-Xlog:gc*,gc+heap=info,gc+age=trace:file=/var/log/jvm/gc.log:time,uptime,level,tags


â†’ ì¥ì•  ì‹œ GC íŒ¨í„´ ë¶„ì„ ê°€ëŠ¥

8. ë§Œì•½ íŠ¸ë˜í”½ì´ ë†’ì€ ì„œë¹„ìŠ¤ë¼ë©´ (ì„ íƒ)
ì‘ë‹µ ì§€ì—° ë¯¼ê° ì„œë¹„ìŠ¤
-XX:MaxGCPauseMillis=100

ë©”ëª¨ë¦¬ ì••ë°• ì‹¬í•  ê²½ìš°
-XX:+AlwaysPreTouch


(ë‹¨, ê¸°ë™ ì‹œê°„ ì¦ê°€)

9. ìš”ì•½ â€“ ê°€ì¥ ì¶”ì²œí•˜ëŠ” êµ¬ì„±

Azure VM (4 vCPU / 16GB)
Spring Boot 3.x / Embedded Tomcat

Heap: 8GB ê³ ì •

GC: G1GC

Pause ëª©í‘œ: 200ms

Thread stack ì¶•ì†Œ

OOM ì¦‰ì‹œ ì¢…ë£Œ + HeapDump

GC ë¡œê·¸ í™œì„±í™”

ì „ì²´ êµ¬ì¡° í•œ ëˆˆì— ë³´ê¸°
Windows Service (NSSM)
 â””â”€ java.exe
     â”œâ”€ JVM Options (-Xms, -Xmx, GC ...)
     â””â”€ -jar myapp.war
         â””â”€ Embedded Tomcat

3. ì¤€ë¹„ ì‚¬í•­ (í•„ìˆ˜)

JDK 17 ì´ìƒ ì„¤ì¹˜

ì˜ˆ: C:\Program Files\Java\jdk-17

Spring Boot WAR íŒŒì¼

ì˜ˆ: C:\app\myapp.war

ë¡œê·¸ ë””ë ‰í„°ë¦¬ ìƒì„±

mkdir C:\logs\jvm


NSSM ì„¤ì¹˜

https://nssm.cc/download

ì˜ˆ: C:\nssm\nssm.exe

4. NSSMìœ¼ë¡œ ì„œë¹„ìŠ¤ ë“±ë¡ (í•µì‹¬ ë‹¨ê³„)
4-1. ì„œë¹„ìŠ¤ ìƒì„±
C:\nssm\nssm.exe install MySpringBootApp


GUI ì°½ì´ ì—´ë¦½ë‹ˆë‹¤.

4-2. Application íƒ­ (ê°€ì¥ ì¤‘ìš”)
Path
C:\Program Files\Java\jdk-17\bin\java.exe

Arguments

ğŸ‘‰ ì—¬ê¸°ì— JVM ì˜µì…˜ + -jar WAR ê²½ë¡œë¥¼ ëª¨ë‘ ë„£ìŒ

-Xms8g
-Xmx8g
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
-XX:InitiatingHeapOccupancyPercent=45
-XX:+ParallelRefProcEnabled
-XX:+UseStringDeduplication
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=C:\logs\jvm\heapdump.hprof
-XX:+ExitOnOutOfMemoryError
-XX:MetaspaceSize=256m
-XX:MaxMetaspaceSize=512m
-Xss512k
-Xlog:gc*,gc+heap=info:file=C:\logs\jvm\gc.log:time,uptime,level,tags
-Dfile.encoding=UTF-8
-jar C:\app\myapp.war


ğŸ“Œ ì£¼ì˜

í•œ ì¤„ë¡œ ë¶™ì—¬ë„ ë˜ê³ , ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ë˜ë©´ ë¨

-jarëŠ” ë°˜ë“œì‹œ ë§ˆì§€ë§‰

java.exe ë’¤ì— ë°”ë¡œ ë“¤ì–´ê°„ë‹¤ê³  ìƒê°í•˜ë©´ ë¨

Startup directory
C:\app


(ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© ì‹œ ì¤‘ìš”)

5. Details íƒ­ (ê¶Œì¥ ì„¤ì •)
í•­ëª©	ê°’
Display name	MySpringBootApp
Startup type	Automatic
Description	Spring Boot Embedded Tomcat Service
6. Exit actions íƒ­ (ìš´ì˜ ì•ˆì •ì„± í•µì‹¬)
ì„¤ì •

Exit action: Restart

Delay: 5000 ms

Restart throttle: 3

Reset throttle: 60000

ì˜ë¯¸

OOM â†’ JVM ì¢…ë£Œ

NSSMì´ 5ì´ˆ í›„ ìë™ ì¬ê¸°ë™

ë¬´í•œ ì¬ì‹œì‘ ë°©ì§€

7. I/O íƒ­ (ë¡œê·¸ ë¶„ë¦¬ â€“ ë§¤ìš° ì¤‘ìš”)
Output (stdout)
C:\logs\app\stdout.log

Error (stderr)
C:\logs\app\stderr.log


ğŸ‘‰ Spring Boot ë¡œê·¸ + JVM ì˜¤ë¥˜ ë¡œê·¸ ë¶„ë¦¬ ê°€ëŠ¥
ğŸ‘‰ ì½˜ì†” ë¡œê·¸ ìœ ì‹¤ ë°©ì§€

8. ì„œë¹„ìŠ¤ ì €ì¥ & ì‹¤í–‰
nssm start MySpringBootApp


ë˜ëŠ”

services.msc


ì—ì„œ ì‹œì‘

9. ì •ìƒ ì ìš© í™•ì¸ ë°©ë²• (ë°˜ë“œì‹œ í™•ì¸)
9-1. í”„ë¡œì„¸ìŠ¤ í™•ì¸
jps -l

9-2. JVM ì˜µì…˜ í™•ì¸
jcmd <PID> VM.flags

9-3. Heap í™•ì¸
jcmd <PID> GC.heap_info

9-4. GC ë¡œê·¸ í™•ì¸
C:\logs\jvm\gc.log

10. NSSM ë°©ì‹ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” ì‹¤ìˆ˜ TOP 5

âŒ Argumentsì— javaë¥¼ ë‹¤ì‹œ ì“°ëŠ” ê²½ìš°
âŒ -jarë¥¼ JVM ì˜µì…˜ ì¤‘ê°„ì— ë„£ëŠ” ê²½ìš°
âŒ HeapDump ê²½ë¡œ ë¯¸ìƒì„±
âŒ ì„œë¹„ìŠ¤ ê³„ì • ê¶Œí•œ ë¶€ì¡±
âŒ Xmx ì„¤ì • ì—†ì´ ìš´ì˜

11. ìš´ì˜ ê´€ì ì—ì„œ NSSM ë°©ì‹ì˜ ì¥ì 
í•­ëª©	ì´ìœ 
ì•ˆì •ì„±	OOM ì‹œ ìë™ ì¬ì‹œì‘
ëª…í™•ì„±	JVM ì˜µì…˜ì´ í•œ ê³³ì— ëª¨ì„
ë°°í¬ í¸ì˜	WAR êµì²´ë§Œìœ¼ë¡œ ë°°í¬
Windows ì¹œí™”	ì„œë¹„ìŠ¤ ê´€ë¦¬ìì™€ ì™„ë²½ í˜¸í™˜


clau

Azure í´ë¼ìš°ë“œ í™˜ê²½(4 vCPU, 16GB ë©”ëª¨ë¦¬)ì—ì„œ Spring Boot 3.x ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ ìµœì í™”ëœ JVM ì„¤ì •ì„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.
ê¶Œì¥ JVM ì„¤ì •
bashJAVA_OPTS="
  -Xms8g
  -Xmx12g
  -XX:+UseG1GC
  -XX:MaxGCPauseMillis=200
  -XX:ParallelGCThreads=4
  -XX:ConcGCThreads=2
  -XX:InitiatingHeapOccupancyPercent=45
  -XX:G1ReservePercent=10
  -XX:G1HeapRegionSize=16m
  -XX:+UseStringDeduplication
  -XX:MaxMetaspaceSize=512m
  -XX:MetaspaceSize=256m
  -XX:+HeapDumpOnOutOfMemoryError
  -XX:HeapDumpPath=/var/log/app/heapdump.hprof
  -XX:+ExitOnOutOfMemoryError
  -Djava.security.egd=file:/dev/./urandom
  -Dserver.tomcat.threads.max=200
  -Dserver.tomcat.threads.min-spare=20
  -Dserver.tomcat.accept-count=100
  -Dserver.tomcat.max-connections=10000
"
ì£¼ìš” ì„¤ì • ì„¤ëª…
ë©”ëª¨ë¦¬ í• ë‹¹

Xms: 8GB (ì´ˆê¸° í™), Xmx: 12GB (ìµœëŒ€ í™) - 16GB ì¤‘ OSì™€ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•´ ì•½ 4GB ì—¬ìœ  í™•ë³´
ì´ˆê¸° í™ì„ ì¶©ë¶„íˆ í¬ê²Œ ì„¤ì •í•˜ì—¬ ì´ˆê¸° GC ë¹ˆë„ ê°ì†Œ

GC ì„¤ì • (G1GC)

G1GCëŠ” ëŒ€ìš©ëŸ‰ í™ì— ì í•©í•˜ë©° ì˜ˆì¸¡ ê°€ëŠ¥í•œ pause time ì œê³µ
MaxGCPauseMillis: 200msë¡œ ì„¤ì •í•˜ì—¬ ì‘ë‹µì„± ìœ ì§€
ParallelGCThreads: 4 (vCPU ìˆ˜ì™€ ë™ì¼)
InitiatingHeapOccupancyPercent: 45%ì—ì„œ GC ì‹œì‘

Metaspace

MaxMetaspaceSize: 512MB (Spring Bootì˜ í´ë˜ìŠ¤ ë¡œë”© ê³ ë ¤)
Spring Boot 3.xì™€ í˜„ëŒ€ì ì¸ í”„ë ˆì„ì›Œí¬ì— ì¶©ë¶„í•œ í¬ê¸°

Tomcat ì„¤ì •

max threads: 200 (ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©)
min-spare: 20 (ê¸°ë³¸ ìŠ¤ë ˆë“œ í’€ ìœ ì§€)
max-connections: 10000 (ë™ì‹œ ì—°ê²° ì²˜ë¦¬)

ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì¶”ê°€ ì˜µì…˜
bashJAVA_OPTS="$JAVA_OPTS
  -XX:+PrintGCDetails
  -XX:+PrintGCDateStamps
  -Xlog:gc*:file=/var/log/app/gc.log:time,uptime:filecount=5,filesize=100m
  -Dcom.sun.management.jmxremote
  -Dcom.sun.management.jmxremote.port=9010
  -Dcom.sun.management.jmxremote.authenticate=false
  -Dcom.sun.management.jmxremote.ssl=false
"
application.properties ì¶”ê°€ ì„¤ì •
properties# Tomcat ìµœì í™”
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=60000
server.tomcat.max-swallow-size=2MB

# Thread pool
spring.task.execution.pool.core-size=10
spring.task.execution.pool.max-size=50
spring.task.execution.pool.queue-capacity=100
ì´ ì„¤ì •ì€ ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ì¤€ì´ë©°, ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¶€í•˜ íŒ¨í„´ê³¼ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ëª¨ë‹ˆí„°ë§ í›„ ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. Azure Monitorë‚˜ Application Insightsë¥¼ í†µí•´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, GC ë¹ˆë„, ì‘ë‹µ ì‹œê°„ì„ ì§€ì†ì ìœ¼ë¡œ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
